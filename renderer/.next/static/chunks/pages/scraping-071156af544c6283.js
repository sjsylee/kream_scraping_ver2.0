(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{33986:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scraping",function(){return o(45764)}])},37911:function(e,t,o){"use strict";o.d(t,{r:function(){return fetchJson}});let ApiError=class ApiError extends Error{constructor(e,t){super("".concat(e," returned ").concat(t)),Error.captureStackTrace&&Error.captureStackTrace(this,ApiError),this.name="ApiError",this.status=t}};async function fetchJson(e,t){let o=await fetch(e,t);if(!o.ok)throw new ApiError(e,o.status);return await o.json()}},45764:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return NextPage}});var r=o(24246),n=o(27378),l=o(8203),i=o(9876),s=o(45149),a=o(46926),c=o(70163),d=o(65493),p=o(47458),x=o(6686),u=o(74231),h=o(9118),_=o(76676),g=o.n(_),f=o(99582),m=o(48315),y=o(89857),j=o(80114),S=o(15425),Z=o(33413),w=o(29858),C=o(4312),T=o(92049),k=o(94472),N=o(47477),b=o(37911),E=o(34522);function exportWorksheet(e,t,o){let r="".concat(e,".").concat(o),n=E.P6.json_to_sheet(t),l=E.P6.book_new();E.P6.book_append_sheet(l,n,"0"),E.NC(l,r)}let{Text:B}=y.default,sleep=e=>new Promise(t=>setTimeout(t,e));function NextPage(){let[e,t]=j.ZP.useMessage(),[o,_]=(0,n.useState)(),[y,E]=(0,n.useState)(),[O,F]=(0,n.useState)([]),[P,v]=(0,n.useState)(!1),[D,J]=(0,n.useState)([]),[I,L]=(0,n.useState)(1),[z,R]=(0,n.useState)("popularity_without_trading"),[A,K]=(0,n.useState)(0),[M,W]=(0,n.useState)(0),[V,X]=(0,n.useState)("");return(0,n.useEffect)(()=>{let e=localStorage.getItem("token");console.log(e),_(e);let t=JSON.parse(localStorage.getItem("profile"));console.log(t),E(t)},[]),(0,r.jsxs)(r.Fragment,{children:[t,(0,r.jsxs)(f.Z,{gutter:5,align:"middle",children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(a.Z,{twoToneColor:"#092635"})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(B,{strong:!0,style:{fontSize:"14px",fontFamily:"establish"},children:"상품 정보 수집"})})]}),(0,r.jsx)(C.Z,{}),(0,r.jsxs)(f.Z,{style:{marginBottom:"10px"},gutter:4,align:"middle",children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(p.Z,{twoToneColor:"#2666CF"})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(B,{style:{color:"#2666CF",fontSize:"12px"},children:"상품을 가져올 페이지를 설정하여 한번 실행에 최대 50개의 상품정보를 가져옵니다."})})]}),(0,r.jsxs)(f.Z,{align:"middle",gutter:8,children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(T.Z,{defaultValue:"popularity_without_trading",onChange:e=>{R(e)},style:{width:140},options:[{value:"popularity_without_trading",label:"인기순"},{value:"male_popularity",label:"남성 인기순"},{value:"female_popularity",label:"여성 인기순"},{value:"wish",label:"관심 많은순"},{value:"style_tags",label:"스타일 많은순"},{value:"pricepremium",label:"프리미엄 높은순"},{value:"pricepremium[asc]",label:"프리미엄 낮은순"}]})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(S.Z,{style:{width:120},min:1,max:99999,step:1,onChange:e=>{L(e)},value:I,formatter:e=>"".concat(e," 페이지"),parser:e=>+e.replace(" 페이지","")})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(g(),{type:"primary",disabled:P,icon:(0,r.jsx)(c.default,{}),onClick:async()=>{if(!o||!y){e.error({content:"로그인이 필요합니다!",icon:(0,r.jsx)(i.Z,{twoToneColor:"#C70039"}),style:{color:"#45474B"}});return}v(!0);let t=o;console.log(o);let n=await (0,b.r)("/api/check_auth",{method:"POST",body:JSON.stringify({token:t})});if("failed"===n.data){e.error({content:"자동 재로그인을 진행합니다...",icon:(0,r.jsx)(l.default,{twoToneColor:"#2185D5"}),style:{color:"#45474B"}});let o=await (0,b.r)("/api/kream_login",{method:"POST",body:JSON.stringify(y)});t=o.data,localStorage.setItem("token",t)}let s=[],a=[];K(0),W(0);let c=await (0,b.r)("/api/get_first_data",{method:"POST",body:JSON.stringify({token:t,page_num:I,search_type:z})});if("ECONNRESET"===c.data)e.error({content:"요청 재시도...",icon:(0,r.jsx)(l.default,{twoToneColor:"#2185D5"}),style:{color:"#45474B"}});else{if("logout"===c.data){e.error({content:"자동 재로그인을 진행합니다...",icon:(0,r.jsx)(l.default,{twoToneColor:"#2185D5"}),style:{color:"#45474B"}});let o=await (0,b.r)("/api/kream_login",{method:"POST",body:JSON.stringify(y)});t=o.data,localStorage.setItem("token",t),c=await (0,b.r)("/api/get_first_data",{method:"POST",body:JSON.stringify({token:t,page_num:I,search_type:z})})}s.push(...JSON.parse(c.data)),K(e=>e+=100/I)}F([...s]),e.success({content:"1차 수집 완료!",icon:(0,r.jsx)(h.Z,{twoToneColor:"#508D69"}),style:{color:"#45474B"}});let d=0;for(let o of s){let n=!0;for(d+=1;n;){let i=await (0,b.r)("/api/get_final_data",{method:"POST",body:JSON.stringify({token:t,product_id:o["상품번호"]})});if("ECONNRESET"===i.data)e.error({content:"요청 재시도...",icon:(0,r.jsx)(l.default,{twoToneColor:"#2185D5"}),style:{color:"#45474B"}}),await sleep(500);else{if("logout"===i.data){e.error({content:"자동 재로그인을 진행합니다...",icon:(0,r.jsx)(l.default,{twoToneColor:"#2185D5"}),style:{color:"#45474B"}});let n=await (0,b.r)("/api/kream_login",{method:"POST",body:JSON.stringify(y)});t=n.data,localStorage.setItem("token",t),i=await (0,b.r)("/api/get_final_data",{method:"POST",body:JSON.stringify({token:t,product_id:o["상품번호"]})})}let c=JSON.parse(i.data);c.map((e,t)=>{0===t?a.push({...o,사이즈:e["사이즈"],평균가_30개:e["평균가_30개"],평균가_50개:e["평균가_50개"],"수집범위/날짜범위_30개":e["수집범위/날짜범위_30개"],"수집범위/날짜범위_50개":e["수집범위/날짜범위_50개"],최저_보판가:e["최저_보판가"],최저_95점_보판가:e["최저_95점_보판가"],최저_일판가:e["최저_일판가"],즉시_판매가:e["즉시_판매가"]}):a.push({상품명:"",상품번호:"",링크:"",모델명:"",컬러:"",사이즈:e["사이즈"],평균가_30개:e["평균가_30개"],평균가_50개:e["평균가_50개"],"수집범위/날짜범위_30개":e["수집범위/날짜범위_30개"],"수집범위/날짜범위_50개":e["수집범위/날짜범위_50개"],최저_보판가:e["최저_보판가"],최저_95점_보판가:e["최저_95점_보판가"],최저_일판가:e["최저_일판가"],즉시_판매가:e["즉시_판매가"]}),t===c.length-1&&a.push({상품명:"",상품번호:"",링크:"",모델명:"",컬러:"",사이즈:"",평균가_30개:"",평균가_50개:"","수집범위/날짜범위_30개":"","수집범위/날짜범위_50개":"",최저_보판가:"",최저_95점_보판가:"",최저_일판가:"",즉시_판매가:""})}),W(e=>e+=100/s.length),await sleep(1500),d%500==0&&(d===s.length||(X("IP 차단 방지를 위해 3분간 정지합니다..."),await sleep(18e4),X(""))),n=!1}}}e.success({content:"최종 수집 완료!",icon:(0,r.jsx)(h.Z,{twoToneColor:"#508D69"}),style:{color:"#45474B"}}),J(e=>a),v(!1)},children:"수집 시작"})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(Z.Z,{title:"작업 초기화",description:"정말로 모든 작업을 초기화 하시겠습니까?",onConfirm:()=>{K(0),W(0),F([]),J([])},onCancel:()=>{},okText:"초기화",cancelText:"종료",children:(0,r.jsx)(g(),{disabled:P,icon:(0,r.jsx)(s.Z,{}),type:"primary",style:{color:"#E6B9DE",fontSize:"14px"},children:"작업 초기화"})})})]}),(0,r.jsx)(C.Z,{}),(0,r.jsxs)(w.Z,{size:"small",style:{width:740,height:400,padding:"3px"},children:[(0,r.jsx)(f.Z,{style:{marginBottom:"5px"},children:(0,r.jsx)(B,{style:{fontSize:"12px",fontFamily:"establish"},children:"진행 정보"})}),(0,r.jsx)(f.Z,{style:{marginBottom:"10px",marginTop:"10px",marginLeft:"5px"},children:(0,r.jsx)(B,{style:{fontSize:"12px",fontFamily:"LINESeedKR-Bd",color:"#607274"},children:"1차 상품 정보 수집 진행률"})}),(0,r.jsx)(f.Z,{style:{marginBottom:"10px",marginTop:"10px",marginLeft:"5px"},children:(0,r.jsx)(k.Z,{percent:Math.round(A),strokeColor:{"0%":"#87d068","100%":"#FC6736"},status:100===A?"success":"active"})}),(0,r.jsx)(f.Z,{style:{marginBottom:"10px",marginTop:"10px",marginLeft:"5px",color:"#607274"},children:(0,r.jsx)(B,{style:{fontSize:"12px",fontFamily:"LINESeedKR-Bd",color:"#607274"},children:"2차 상품 정보 수집 진행률"})}),(0,r.jsx)(f.Z,{style:{marginBottom:"10px",marginTop:"10px",marginLeft:"5px"},children:(0,r.jsx)(k.Z,{percent:Math.round(100*M)/100,strokeColor:{"0%":"#FC6736","100%":"#108ee9"},status:100===Math.round(M)?"success":"active"})}),(0,r.jsxs)(f.Z,{align:"middle",gutter:4,style:{marginBottom:"15px",marginTop:"10px",marginLeft:"5px"},children:[(0,r.jsx)(m.Z,{children:""!==V&&(0,r.jsx)(p.Z,{twoToneColor:"#2666CF"})}),(0,r.jsx)(m.Z,{children:(0,r.jsx)(B,{style:{color:"#2666CF",fontSize:"12px"},children:V})})]}),(0,r.jsx)(f.Z,{style:{marginBottom:"15px",marginTop:"10px",marginLeft:"5px"},children:(0,r.jsx)(m.Z,{children:(0,r.jsx)(N.Z,{loading:P,title:"최종 수집 개수",value:D.filter(e=>""!==e["상품명"]).length,suffix:"개",prefix:(0,r.jsx)(u.Z,{}),valueStyle:{color:"#0C2D57",fontFamily:"LINESeedKR-Bd"}})})}),(0,r.jsx)(C.Z,{}),(0,r.jsx)(f.Z,{style:{marginBottom:"10px"},children:(0,r.jsx)(B,{style:{fontSize:"12px",fontFamily:"LINESeedKR-Bd"},children:"출력"})}),(0,r.jsxs)(f.Z,{children:[(0,r.jsx)(m.Z,{style:{marginRight:"5px"},children:(0,r.jsx)(g(),{type:"primary",disabled:P,icon:(0,r.jsx)(x.Z,{twoToneColor:"#CDFAD5"}),onClick:()=>{if(0===D.length){e.error({content:"출력할 데이터가 없습니다!",icon:(0,r.jsx)(i.Z,{twoToneColor:"#C70039"}),style:{color:"#45474B"}});return}exportWorksheet("Kream 상품 수집 정보 출력",D,"xlsx")},children:(0,r.jsx)(B,{style:{color:"#CDFAD5"},children:"엑셀 출력"})})}),(0,r.jsx)(m.Z,{style:{marginRight:"5px"},children:(0,r.jsx)(g(),{type:"primary",disabled:P,icon:(0,r.jsx)(d.Z,{twoToneColor:"#FFCF96"}),onClick:()=>{if(0===D.length){e.error({content:"출력할 데이터가 없습니다!",icon:(0,r.jsx)(i.Z,{twoToneColor:"#C70039"}),style:{color:"#45474B"}});return}exportWorksheet("Kream 상품 수집 정보 출력",D,"csv")},children:(0,r.jsx)(B,{style:{color:"#FFCF96"},children:"CSV 출력"})})})]})]})]})}},36786:function(){},43197:function(){}},function(e){e.O(0,[556,581,795,774,888,179],function(){return e(e.s=33986)}),_N_E=e.O()}]);